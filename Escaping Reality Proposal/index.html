<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame Mega City VR</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <!-- Environment & Extras for physics and ocean/weather -->
    <script src="https://unpkg.com"></script>
    <script src="https://cdn.jsdelivr.net"></script>

    <script>
      // Component to handle Day/Night Cycle and Weather
      AFRAME.registerComponent('city-logic', {
        init: function () {
          this.sun = document.querySelector('#sun');
          this.sky = document.querySelector('a-sky');
          this.time = 0;
        },
        tick: function (t, dt) {
          this.time += dt * 0.0001;
          let lightIntensity = Math.max(0.2, Math.sin(this.time) + 0.5);
          this.sun.setAttribute('intensity', lightIntensity);
          
          // Toggle Fog for "Weather" effect periodically
          if (Math.sin(this.time * 2) > 0.8) {
            this.el.sceneEl.setAttribute('fog', 'type: exponential; color: #aaa; density: 0.05');
          } else {
            this.el.sceneEl.setAttribute('fog', 'type: exponential; color: #aaa; density: 0.01');
          }
        }
      });

      // Component for driving vehicles
      AFRAME.registerComponent('drive', {
        schema: { speed: {type: 'number', default: 0.2}, direction: {type: 'number', default: 1} },
        tick: function () {
          let pos = this.el.getAttribute('position');
          pos.z += this.data.speed * this.data.direction;
          if (pos.z > 50) pos.z = -50;
          if (pos.z < -50) pos.z = 50;
          this.el.setAttribute('position', pos);
        }
      });
    </script>
  </head>

  <body>
    <a-scene city-logic fog="type: exponential; color: #74b9ff; density: 0.01">
      
      <a-assets>
        <!-- Replace URLs with your own GLTF assets if preferred -->
        <a-asset-item id="car-model" src="https://cdn.jsdelivr.net"></a-asset-item>
        <audio id="engine-sound" src="https://cdn.freesound.org" preload="auto"></audio>
      </a-assets>

      <!-- Camera with Collision -->
      
        
          <a-cursor></a-cursor>
        
      

      <!-- Environment: City Style -->
      
      
      <!-- Lighting (Sun & Moon) -->
      <a-light id="sun" type="directional" position="1 10 1" intensity="1"></a-light>
      <a-light type="ambient" intensity="0.3"></a-light>

      <!-- Roads -->
      <a-plane position="0 0.01 0" rotation="-90 0 0" width="10" height="100" color="#333"></a-plane>
      
      <!-- Traffic: Cars, Trucks, Buses (Represented by GLTF and Shapes) -->
      
        <!-- GLTF Car with Sound -->
        
          <a-box opacity="0" static-body></a-box> <!-- Collision Box -->
        

        <!-- Bus (Yellow) -->
        <a-box color="yellow" position="2 1 5" width="2" height="2" depth="6" drive="speed: 0.1; direction: -1">
          <a-text value="BUS" align="center" position="0 2.1 0" color="black"></a-text>
        </a-box>

        <!-- Emergency Vehicle (Police) -->
        <a-box color="blue" position="-2 0.5 20" width="1.5" height="1" depth="3" drive="speed: 0.3">
          <a-light type="point" color="red" intensity="2" animation="property: intensity; from: 0; to: 2; dir: alternate; dur: 200; loop: true"></a-light>
        </a-box>
      

      <!-- Trees (Swaying Animation) -->
      
        <a-cylinder color="#4b3621" radius="0.2" height="2"></a-cylinder>
        <a-sphere color="#2d5a27" radius="1" position="0 2 0"></a-sphere>
      

      <!-- Traffic Light -->
      
        <a-cylinder color="black" radius="0.1" height="4"></a-cylinder>
        <a-box color="#222" position="0 4 0" width="0.5" height="1.5" depth="0.5">
          <a-circle color="red" position="0 0.4 0.26" radius="0.15" animation="property: opacity; from: 1; to: 0.2; dir: alternate; dur: 3000; loop: true"></a-circle>
          <a-circle color="green" position="0 -0.4 0.26" radius="0.15" animation="property: opacity; from: 0.2; to: 1; dir: alternate; dur: 3000; loop: true"></a-circle>
        </a-box>
      

      <!-- Interactive Pedestrian (Click to interact) -->
      <a-sphere position="4 1 -8" radius="0.5" color="orange" 
                animation="property: position; to: 8 1 -8; dir: alternate; dur: 5000; loop: true"
                onclick="alert('Hello Citizen!')">
        <a-text value="Click Me" align="center" position="0 1 0" color="black"></a-text>
      </a-sphere>

    </a-scene>
  </body>
</html>
