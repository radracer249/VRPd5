<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>A-Frame City Simulation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <!-- Physics -->
  <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>

  <!-- Extras -->
  <script src="https://unpkg.com/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  <!-- Custom Components -->
  <script>
    AFRAME.registerComponent("move-forward", {
      schema: { speed: { default: 0.05 } },
      tick: function () {
        this.el.object3D.position.z += this.data.speed;
        if (this.el.object3D.position.z > 20) {
          this.el.object3D.position.z = -40;
        }
      }
    });

    AFRAME.registerComponent("sway", {
      tick: function (time) {
        this.el.object3D.rotation.z = Math.sin(time / 1000) * 0.05;
      }
    });

    AFRAME.registerComponent("day-night", {
      tick: function (time) {
        const sky = document.querySelector("#sky");
        const sun = document.querySelector("#sun");
        const cycle = (time / 20000) % 1;

        if (cycle < 0.5) {
          sky.setAttribute("color", "#88ccee");
          sun.setAttribute("light", "intensity: 1");
        } else {
          sky.setAttribute("color", "#001122");
          sun.setAttribute("light", "intensity: 0.2");
        }
      }
    });
  </script>
</head>

<body>
<a-scene
  physics="gravity: -9.8"
  fog="type: exponential; color: #aaa; density: 0.02"
  background="color: #ECECEC">

  <!-- Assets -->
  <a-assets>
    <a-asset-item id="car" src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models/2.0/VC/glTF/VC.gltf"></a-asset-item>
    <audio id="engine" src="https://cdn.jsdelivr.net/gh/mdn/webaudio-examples/audio-analyser/viper.ogg"></audio>
    <audio id="siren" src="https://cdn.jsdelivr.net/gh/joshwcomeau/ambient-sound-effects/police-siren.mp3"></audio>
  </a-assets>

  <!-- Camera -->
  <a-entity position="0 1.6 5">
    <a-camera wasd-controls look-controls
      raycaster="objects: .collidable"
      cursor="fuse: false">
    </a-camera>
  </a-entity>

  <!-- Sky -->
  <a-sky id="sky" color="#88ccee"></a-sky>

  <!-- Sun / Moon -->
  <a-entity id="sun"
    light="type: directional; intensity: 1"
    position="0 10 -10"
    day-night>
  </a-entity>

  <!-- Ground / Road -->
  <a-plane
    rotation="-90 0 0"
    width="50"
    height="100"
    color="#333"
    static-body>
  </a-plane>

  <!-- Road lines -->
  <a-box position="0 0.01 -10" width="0.3" height="0.01" depth="80" color="#fff"></a-box>

  <!-- Buildings -->
  <a-box position="-6 4 -10" width="4" height="8" depth="4" color="#999" static-body></a-box>
  <a-box position="6 5 -15" width="4" height="10" depth="4" color="#777" static-body></a-box>

  <!-- Trees -->
  <a-cylinder position="-10 2 -8" height="4" radius="0.5" color="#6b4f2c"></a-cylinder>
  <a-sphere position="-10 5 -8" radius="2" color="#2ecc71" sway></a-sphere>

  <!-- Moving Cars -->
  <a-entity gltf-model="#car"
    scale="0.5 0.5 0.5"
    position="1 0.2 -30"
    move-forward
    sound="src: #engine; autoplay: true; loop: true">
  </a-entity>

  <!-- Bus -->
  <a-box position="-2 0.5 -20"
    width="2"
    height="1"
    depth="4"
    color="#f1c40f"
    move-forward>
  </a-box>

  <!-- Police Car -->
  <a-entity gltf-model="#car"
    scale="0.45 0.45 0.45"
    position="3 0.2 -40"
    move-forward
    sound="src: #siren; autoplay: true; loop: true">
  </a-entity>

  <!-- Pedestrian -->
  <a-cylinder position="-1 1 -5" height="2" radius="0.4" color="#3498db"
    animation="property: position; to: -1 1 -20; dur: 8000; loop: true">
  </a-cylinder>

  <!-- Traffic Light -->
  <a-box position="2 2 -5" width="0.2" height="4" depth="0.2" color="#000"></a-box>
  <a-sphere position="2 3 -5" radius="0.2" color="red"
    animation="property: color; from: red; to: green; dur: 3000; loop: true">
  </a-sphere>

  <!-- Rain -->
  <a-entity particle-system="
    preset: rain;
    particleCount: 3000;
    color: #9ecfff;">
  </a-entity>

  <!-- UI Text -->
  <a-text
    value="City Simulation â€” WASD to move"
    position="-3 4 -5"
    width="6"
    color="#000">
  </a-text>

</a-scene>
</body>
</html>
