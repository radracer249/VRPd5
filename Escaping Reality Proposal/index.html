<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>A-Frame City Simulation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Prevent white flash -->
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
  </style>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <!-- Extras -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  <!-- Particle System (REQUIRED) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-particle-system-component@1.0.0/dist/aframe-particle-system-component.min.js"></script>
</head>

<body>
<a-scene
  loading-screen="enabled: false"
  fog="type: linear; color: #aaa; near: 10; far: 80"
  renderer="colorManagement: true; physicallyCorrectLights: true">

  <!-- ASSETS -->
  <a-assets>
    <a-asset-item id="car" src="https://cdn.aframe.io/test-models/models/gltf/Car.glb"></a-asset-item>
    <a-asset-item id="bus" src="https://cdn.aframe.io/test-models/models/gltf/Bus.glb"></a-asset-item>

    <audio id="engine" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6e3dbdb7fa.mp3"></audio>
    <audio id="rain" src="https://cdn.pixabay.com/audio/2021/08/04/audio_89cbe1c35f.mp3"></audio>
  </a-assets>

  <!-- LIGHTING (CRITICAL) -->
  <a-entity light="type: ambient; intensity: 0.6"></a-entity>
  <a-entity id="sun" light="type: directional; intensity: 1" position="10 20 10"></a-entity>
  <a-entity id="moon" light="type: directional; intensity: 0.3; color: #8899ff" position="-10 -20 -10"></a-entity>

  <!-- CAMERA -->
  <a-entity id="player" position="0 1.6 6" movement-controls>
    <a-camera wasd-controls look-controls></a-camera>
  </a-entity>

  <!-- SKY -->
  <a-sky id="sky" color="#87CEEB"></a-sky>

  <!-- GROUND -->
  <a-plane rotation="-90 0 0" width="200" height="200" color="#444"></a-plane>

  <!-- ROADS -->
  <a-plane rotation="-90 0 0" width="10" height="200" color="#222"></a-plane>
  <a-plane rotation="-90 0 0" width="200" height="10" color="#222"></a-plane>

  <!-- BUILDINGS -->
  <a-box position="5 5 -10" width="6" height="10" depth="6" color="#999"></a-box>
  <a-box position="-6 4 -12" width="5" height="8" depth="5" color="#777"></a-box>

  <!-- TREE -->
  <a-entity position="-10 0 -5">
    <a-cylinder height="3" radius="0.3" color="#8B4513"></a-cylinder>
    <a-sphere position="0 3 0" radius="1.5" color="#228B22"
      animation="property: rotation; to: 0 10 0; dir: alternate; dur: 2000; loop: true">
    </a-sphere>
  </a-entity>

  <!-- TRAFFIC LIGHT -->
  <a-sphere position="0 3.5 -5" radius="0.3" color="red"
    animation="property: color; from: red; to: green; dur: 4000; loop: true; dir: alternate">
  </a-sphere>

  <!-- CAR -->
  <a-entity gltf-model="#car" scale="0.02 0.02 0.02"
    position="-20 0.1 0"
    animation="property: position; to: 20 0.1 0; dur: 15000; loop: true"
    sound="src: #engine; autoplay: true; loop: true">
  </a-entity>

  <!-- BUS -->
  <a-entity gltf-model="#bus" scale="0.03 0.03 0.03"
    position="0 0.1 -20"
    rotation="0 90 0"
    animation="property: position; to: 0 0.1 20; dur: 20000; loop: true"
    sound="src: #engine; autoplay: true; loop: true">
  </a-entity>

  <!-- PEDESTRIAN -->
  <a-box position="-5 1 -2" height="2" width="0.5" depth="0.5" color="#FFD700"
    animation="property: position; to: 5 1 -2; dur: 8000; loop: true">
  </a-box>

  <!-- RAIN -->
  <a-entity particle-system="preset: rain; particleCount: 3000"
            sound="src: #rain; autoplay: true; loop: true">
  </a-entity>

  <!-- DAY / NIGHT -->
  <script>
    const sky = document.querySelector('#sky');
    const sun = document.querySelector('#sun');
    const moon = document.querySelector('#moon');
    let day = true;

    setInterval(() => {
      if (day) {
        sky.setAttribute('color', '#001133');
        sun.setAttribute('light', 'intensity', 0);
        moon.setAttribute('light', 'intensity', 0.6);
      } else {
        sky.setAttribute('color', '#87CEEB');
        sun.setAttribute('light', 'intensity', 1);
        moon.setAttribute('light', 'intensity', 0.3);
      }
      day = !day;
    }, 15000);
  </script>

</a-scene>
</body>
</html>
