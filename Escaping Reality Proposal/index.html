<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>A-Frame City Simulation (Full)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #000;
  overflow: hidden;
}
</style>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aframe-particle-system-component@1.0.0/dist/aframe-particle-system-component.min.js"></script>
</head>

<body>
<a-scene
  loading-screen="enabled: false"
  fog="type: linear; color: #8899aa; near: 25; far: 140"
  renderer="colorManagement: true">

  <!-- ASSETS -->
  <a-assets>
    <a-asset-item id="car" src="https://cdn.aframe.io/test-models/models/gltf/Car.glb"></a-asset-item>
    <a-asset-item id="bus" src="https://cdn.aframe.io/test-models/models/gltf/Bus.glb"></a-asset-item>
    <a-asset-item id="police" src="https://cdn.aframe.io/test-models/models/gltf/PoliceCar.glb"></a-asset-item>

    <audio id="engine" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6e3dbdb7fa.mp3"></audio>
    <audio id="rainSound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_89cbe1c35f.mp3"></audio>
  </a-assets>

  <!-- LIGHTING -->
  <a-entity light="type: ambient; intensity: 0.6"></a-entity>
  <a-entity id="sun" light="type: directional; intensity: 1" position="10 25 10"></a-entity>
  <a-entity id="moon" light="type: directional; intensity: 0.3; color: #8899ff" position="-10 -25 -10"></a-entity>

  <!-- CAMERA + COLLISION -->
  <a-entity id="player" position="0 1.6 8">
    <a-camera wasd-controls look-controls></a-camera>
  </a-entity>

  <!-- SKY -->
  <a-sky id="sky" color="#87CEEB"></a-sky>

  <!-- GROUND -->
  <a-plane rotation="-90 0 0" width="300" height="300" color="#444"></a-plane>

  <!-- ROADS -->
  <a-plane rotation="-90 0 0" width="12" height="200" color="#222"></a-plane>
  <a-plane rotation="-90 0 0" width="200" height="12" color="#222"></a-plane>

  <!-- BUILDINGS (COLLISION) -->
  <a-box position="6 6 -10" width="6" height="12" depth="6" color="#888"></a-box>
  <a-box position="-8 5 -14" width="5" height="10" depth="5" color="#777"></a-box>
  <a-box position="14 8 -22" width="8" height="16" depth="8" color="#666"></a-box>

  <!-- TREES -->
  <a-entity position="-12 0 -6">
    <a-cylinder height="3" radius="0.35" color="#7A4A2E"></a-cylinder>
    <a-sphere position="0 3 0" radius="1.6" color="#2E8B57"
      animation="property: rotation; to: 0 15 0; dir: alternate; dur: 2500; loop: true">
    </a-sphere>
  </a-entity>

  <!-- TRAFFIC LIGHT -->
  <a-box position="0 2 -6" width="0.3" height="4" depth="0.3" color="#333"></a-box>
  <a-sphere position="0 3.5 -6" radius="0.3" color="red"
    animation="property: color; from: red; to: green; dur: 4000; loop: true; dir: alternate">
  </a-sphere>

  <!-- VEHICLES -->
  <a-entity gltf-model="#car" scale="0.02 0.02 0.02"
    position="-25 0.1 0"
    animation="property: position; to: 25 0.1 0; dur: 14000; loop: true"
    sound="src: #engine; autoplay: false; loop: true">
  </a-entity>

  <a-entity gltf-model="#bus" scale="0.03 0.03 0.03"
    position="0 0.1 -25"
    rotation="0 90 0"
    animation="property: position; to: 0 0.1 25; dur: 20000; loop: true"
    sound="src: #engine; autoplay: false; loop: true">
  </a-entity>

  <a-entity gltf-model="#police" scale="0.02 0.02 0.02"
    position="25 0.1 -4"
    rotation="0 180 0"
    animation="property: position; to: -25 0.1 -4; dur: 12000; loop: true">
  </a-entity>

  <!-- PEDESTRIAN -->
  <a-box position="-6 1 -2" width="0.5" height="2" depth="0.5" color="#FFD700"
    animation="property: position; to: 6 1 -2; dur: 8000; loop: true">
  </a-box>

  <!-- WEATHER -->
  <a-entity particle-system="preset: rain; particleCount: 2500"
            sound="src: #rainSound; autoplay: false; loop: true">
  </a-entity>

  <!-- DAY / NIGHT -->
  <script>
    const sky = document.querySelector('#sky');
    const sun = document.querySelector('#sun');
    const moon = document.querySelector('#moon');
    let day = true;

    setInterval(() => {
      if (day) {
        sky.setAttribute('color', '#020924');
        sun.setAttribute('light', 'intensity', 0.2);
        moon.setAttribute('light', 'intensity', 0.6);
      } else {
        sky.setAttribute('color', '#87CEEB');
        sun.setAttribute('light', 'intensity', 1);
        moon.setAttribute('light', 'intensity', 0.3);
      }
      day = !day;
    }, 15000);

    // Enable sound after user click (browser rule)
    document.body.addEventListener('click', () => {
      document.querySelectorAll('[sound]').forEach(e => {
        e.components.sound.playSound();
      });
    }, { once: true });
  </script>

</a-scene>
</body>
</html>
